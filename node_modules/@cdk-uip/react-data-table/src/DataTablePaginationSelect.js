import React from "react";
import classnames from "classnames";
import { Button } from "@cdk-uip/react-button";
import { Menu, MenuItem, MenuAnchor } from "@cdk-uip/react-menu";
import { func, number, node, oneOfType, string } from "prop-types";

/**
 * Display a drop-down allowing the user to select the number of rows per-page.
 *
 * The selection is supplied in the form of `<option>` elements. For example:
 *
 * ```js
 * <DataTablePaginationSelect>
 *   <option value={5}>5</option>
 *   <option value={10}>10</option>
 *   <option value={25}>25</option>
 * </DataTablePaginationSelect>
 * ```
 */
class DataTablePaginationSelect extends React.Component {
  static propTypes = {
    /** The drop-down label (e.g. "Rows per-page:") */
    label: node,
    /** The currently selected value */
    value: oneOfType([string, number]),
    /** Called with the new value when the selection has changed. */
    onChange: func
  };

  state = { open: false };

  render() {
    const {
      className,
      label,
      value,
      onChange,
      children,
      ...other
    } = this.props;

    const options = React.Children.toArray(children);
    const values = options.map(item => item.props.value);

    return (
      <div
        className={classnames("cdk-data-table-pagination__select", className)}
        {...other}
      >
        <div>{label}</div>

        <div className="cdk-data-table-pagination__select__surface">
          <Button
            className="cdk-data-table-pagination__select__button"
            onClick={() => this.setState({ open: true })}
          >
            {value}
          </Button>
          <MenuAnchor>
            <Menu
              open={this.state.open}
              onCancel={() => this.setState({ open: false })}
              onSelected={index => {
                this.setState({ open: false });
                onChange && onChange(values[index]);
              }}
            >
              {options.map((child, index) => (
                <MenuItem key={index} id={child.props.value}>
                  {child.props.children}
                </MenuItem>
              ))}
            </Menu>
          </MenuAnchor>
        </div>
      </div>
    );
  }
}

export default DataTablePaginationSelect;
