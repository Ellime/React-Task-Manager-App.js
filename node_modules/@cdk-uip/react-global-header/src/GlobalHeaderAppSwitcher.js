import React, { Fragment } from "react";
import GlobalHeaderIcon from "./GlobalHeaderIcon";
import {
  AppSwitcher,
  AppSwitcherHome,
  AppSwitcherItems
} from "@cdk-uip/react-app-switcher";
import { node, func } from "prop-types";

/**
 * High-level component that includes an app switcher in a global header
 * using the correct icon.
 */
export default class GlobalHeaderAppSwitcher extends React.Component {
  static propTypes = {
    /**
     * Use this to display an optional caption that be clicked on to back
     * to your home page/portal.
     */
    home: node,
    /**
     * Called when the home caption is clicked.
     */
    onHome: func
  };

  state = { open: false };

  render() {
    const { home, onHome, children } = this.props;

    return (
      <Fragment>
        <GlobalHeaderIcon
          element="span"
          className="mdc-menu-anchor"
          onClick={() => this.setState({ open: true })}
        >
          apps
        </GlobalHeaderIcon>
        <AppSwitcher
          open={this.state.open}
          onCancel={() => this.setState({ open: false })}
        >
          {home && (
            <AppSwitcherHome
              onClick={e => {
                e.stopPropagation();
                this.setState({ open: false });
                onHome && onHome(e);
              }}
            >
              {home}
            </AppSwitcherHome>
          )}

          <AppSwitcherItems>
            {React.Children.map(children, app =>
              React.cloneElement(app, {
                onClick: e => {
                  e.stopPropagation();
                  this.setState({ open: false });
                  app.props.onClick && app.props.onClick(e);
                }
              })
            )}
          </AppSwitcherItems>
        </AppSwitcher>
      </Fragment>
    );
  }
}
