import React from "react";
import { storiesOf } from "@storybook/react";
import { action } from "@storybook/addon-actions";
import PersistentSearchBox from "./PersistentSearchBox";

storiesOf("persistent-search-box", module).add("controlled", () => {
  class ControlledPersistentSearchBox extends React.Component {
    state = { value: "", results: [] };

    handleChange = e => {
      action("onChange")(e);
      this.setState({ value: e.target.value });
    };

    handleClear = () => {
      action("onClear")();
      this.setState({ value: "" });
    };

    handleBack = () => {
      action("onBack")();
      this.setState({ value: "", results: [] });
    };

    handleFetch = value => {
      action("onFetch")(value);
      // Spoof a 500m/s API lookup
      setTimeout(() => {
        this.setState({ results: [...value] });
      }, 500);
    };

    handleClick = (result, index) => {
      action("onClick")(result, index);
      this.setState({ value: result });
    };

    render() {
      return (
        <PersistentSearchBox
          value={this.state.value}
          onChange={this.handleChange}
          label="Search for something"
          results={this.state.results}
          onFetch={this.handleFetch}
          onClear={this.handleClear}
          onBack={this.handleBack}
          onClick={this.handleClick}
        />
      );
    }
  }

  return <ControlledPersistentSearchBox />;
});
