import React from "react";
import { SpeedDial, SpeedDialItem } from ".";
import renderer from "react-test-renderer";
import TestUtils from "react-dom/test-utils";

it("renders", () => {
  expect(
    renderer.create(
      <SpeedDial icon="home">
        <SpeedDialItem icon="email" />
        <SpeedDialItem icon="chat" />
        <SpeedDialItem icon="call" />
      </SpeedDial>
    )
  ).toMatchSnapshot();
});

it("opens", () => {
  const onClickEmail = jest.fn();
  const component = TestUtils.renderIntoDocument(
    <SpeedDial icon="home">
      <SpeedDialItem icon="email" onClick={onClickEmail} />
      <SpeedDialItem icon="chat" />
      <SpeedDialItem icon="call" />
    </SpeedDial>
  );
  // Find the buttons
  const buttons = TestUtils.scryRenderedDOMComponentsWithTag(
    component,
    "button"
  );
  expect(buttons.length).toBe(4);
  const emailButton = buttons[0];
  const mainButton = buttons[3];

  // Clicking the email button should not work yet
  TestUtils.Simulate.click(emailButton);
  expect(onClickEmail).not.toHaveBeenCalled();

  // Open the menu
  TestUtils.Simulate.click(mainButton);

  // Email should work
  TestUtils.Simulate.click(emailButton);
  expect(onClickEmail).toHaveBeenCalled();

  // Open the menu again
  TestUtils.Simulate.click(mainButton);
  // Find the backdrop and click on it
  const backdrop = TestUtils.findRenderedDOMComponentWithClass(
    component,
    "cdk-speed-dial__backdrop"
  );
  TestUtils.Simulate.click(backdrop);
  // The menu should be closed
  TestUtils.Simulate.click(emailButton);
  expect(onClickEmail).toHaveBeenCalledTimes(1);
});
