'use strict';

var spawn = require('cross-spawn');
var path = require('path');
var paths = require('../../config/paths');
var fs = require('fs-extra');

/**
 * Execute a binary that is local to this package.
 */
module.exports = function npmbin(cmd, args, cb) {
  var bin = cmd;

  if (fs.existsSync(paths.yarnLockFile)) {
    // Yarn and npm3 put binaries in a different place.
    bin = path.resolve(__dirname, '../..', `node_modules/.bin/${cmd}`);
    // A yarn.lock does not necessarily rule out npm running
    if (!fs.existsSync(bin)) {
      // Use the cmd as passed
      bin = cmd;
    }
  }

  const proc = spawn(bin, args, {
    stdio: 'inherit',
  });

  proc.on('close', cb);
};
