# IntlProvider

A replacement for `react-intl` `IntlProvider` that lets you separate displayed messages from the locale settings. For example, you may wish to display US date formats while displaying Finnish strings. Using this component makes it possible to dynamically change language and locale settings in your application.

## Installation

```bash
npm install --save @cdkglobal/react-core-intl-provider
```

```js
import IntlProvider from "@cdkglobal/react-core-intl-provider";
```

## Usage

The component requires you to supply two function props that will load locale data and the message hash. Your functions need to return a `Promise` which gives you the ability to lazy-load the data.

For example, an application that supports British English and Finnish might look like this:

```js static
class App extends React.Component {
  state = {
    locale: "en-GB",
    language: "en-GB"
  };

  loadLocaleData = ({ primary, region }) => {
    // Set the moment locale
    moment.locale(`${primary}-${region}`);
    // Map of locales => data
    const data = {
      en: () => import(`react-intl/locale-data/en`),
      fi: () => import(`react-intl/locale-data/fi`)
    };
    return data[primary]();
  };

  loadMessages = ({ primary, region }) => {
    // Map of message hashes
    const data = {
      "en-GB": () => import("../../i18n/en-GB.json"),
      "en-FI": () => import("../../i18n/fi-FI.json")
    };
    return (data[`${primary}-${region}`] || data[primary])();
  };

  render() {
    const { locale, language } = this.state;

    return (
      <IntlProvider
        language={language}
        locale={locale}
        loadLocaleData={this.loadLocaleData}
        loadMessages={this.loadMessages}
        defaultLocale="en"
      >
        <div>My application</div>
      </IntlProvider>
    )
  }
}
```

> **NOTE**: Do not be tempted to use a string template to load your locale settings. It will mean larger production builds as Webpack will compile all available `react-intl` locale data.

```js static
// Don't do this!
loadLocaleData = ({ primary }) => import(`react-intl/locale-data/${primary}`);
```

Both the `loadLocaleData` and `loadMessages` props will pass an object containing the locale split into `primary` and `region`:

```js static
{
  primary,
  region
}
```

For example, if the `locale` is set to `en-US` then `loadLocaleData` and `loadMessages` will be called with:

```js static
{
  primary: "en",
  region: "US"
}
```

If you already have everything loaded then you can simple resolve a `Promise` with your data. For example:

```js static
const localeEn = import(`react-intl/locale-data/en`);
const localeFi = import(`react-intl/locale-data/fi`);
const messagesEn = import("./i18n/en-GB.json");
const messagesFi = import("./i18n/fi-FI.json");

...

loadLocaleData = ({ primary }) => {
  const data = {
    en: localeEn,
    fi: localeFi
  };
  return Promise.resolve(data[primary]);
};

loadMessages = ({ primary, region }) => {
  const map = {
    "en-GB": messagesEn,
    "en-FI": messagesFi
  };
  return Promise.resolve(data[`${primary}-${region}`]);
};
```
